{"version":3,"sources":["../src/modal_logentry_form.js"],"names":["define","$","Event","Str","Notification","CustomEvents","Modal","ModalRegistry","Fragment","LogbookEvents","Repository","Selectors","registered","SELECTORS","ADVANCED_FORM","SAVE_BUTTON","LOADING_ICON_CONTAINER","ModalLogEntryForm","root","call","contextId","courseId","userId","logentryId","flightDate","exerciseId","pirepLookupId","hasfindpirep","reloadingBody","reloadingTitle","saveButton","getFooter","find","TYPE","prototype","Object","create","constructor","setContextId","id","getContextId","setCourseId","getCourseId","hasCourseId","setExerciseId","getExerciseId","hasExerciseId","setUserId","getUserId","hasUserId","setLogentryId","getLogentryId","hasLogentryId","setFlightDate","time","getFlightDate","hasFlightDate","setFlightType","flighttype","flightType","getFlightType","hasFindPIREP","getForm","getBody","disableButtons","prop","enableButtons","reloadTitleContent","titlePromise","getExerciseName","then","response","exercisename","fail","exception","string","setTitle","bind","always","reloadBodyContent","formData","bodyPromise","args","userid","logentryid","flightdate","courseid","exerciseid","formdata","loadFragment","setBody","pirepdiv","parent","length","append","doDynamicDisplay","setInputMask","registerChangeListeners","bookingwrapper","data","Inputmask","mask","document","getElementById","val","pirepbutton","on","e","isNaN","getPIREPData","applyFlightTimes","passfail","flightrule","flighttime","onchange","loadingContainer","rule","pirep","removeClass","findPirep","result","get_string","addClass","d","Date","logentry","month","getMonth","day","getDate","year","getFullYear","deptime","hour","substring","minute","indexOf","linkedpirep","depicao","arricao","arrtime","callsign","aircraft","aircraftreg","enginetype","route","fstd","warnings","message","focus","show","each","insertAfter","preventDefault","stopPropagation","force","ifr","editmode","toggle","div","element","value","ariaexpanded","attr","slideDown","slideUp","setLabel","editlabelkey","labelkey","label","text","p1label","reloadAllContent","when","hide","getFormData","serialize","save","invalid","first","formArgs","submitCreateUpdateLogentryForm","validationerror","isExisting","trigger","updated","created","fetchNotifications","registerEventListeners","getModal","events","activate","submit","originalEvent","notifyFormSubmitAjax","setTimeout","register"],"mappings":"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","sourcesContent":["/* eslint-disable no-nested-ternary */\n/* eslint-disable complexity */\n/* eslint-disable babel/new-cap */\n/* eslint-disable no-undef */\n// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * This module handles logbook entry form.\n *\n * @module     local_booking/modal_logentry_form\n * @author     Mustafa Hajjar (mustafahajjar@gmail.com)\n * @copyright  BAVirtual.co.uk Â© 2021\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine([\n        'jquery',\n        'core/event',\n        'core/str',\n        'core/notification',\n        'core/custom_interaction_events',\n        'core/modal',\n        'core/modal_registry',\n        'core/fragment',\n        'local_booking/events',\n        'local_booking/repository',\n        'local_booking/selectors',\n    ],\n    function(\n        $,\n        Event,\n        Str,\n        Notification,\n        CustomEvents,\n        Modal,\n        ModalRegistry,\n        Fragment,\n        LogbookEvents,\n        Repository,\n        Selectors,\n    ) {\n\n    var registered = false;\n    var SELECTORS = {\n        ADVANCED_FORM: '[data-form-type=\"other\"]',\n        SAVE_BUTTON: '[data-action=\"save\"]',\n        LOADING_ICON_CONTAINER: '[data-region=\"loading-icon-container\"]',\n    };\n\n    /**\n     * Constructor for the Modal.\n     *\n     * @param {object} root The root jQuery element for the modal\n     */\n    var ModalLogEntryForm = function(root) {\n        Modal.call(this, root);\n        this.contextId = null;\n        this.courseId = null;\n        this.userId = null;\n        this.logentryId = null;\n        this.flightDate = null;\n        this.exerciseId = null;\n        this.pirepLookupId = null;\n        this.hasfindpirep = false;\n        this.reloadingBody = false;\n        this.reloadingTitle = false;\n        this.saveButton = this.getFooter().find(SELECTORS.SAVE_BUTTON);\n    };\n\n    ModalLogEntryForm.TYPE = 'local_booking-modal_logentry_form';\n    ModalLogEntryForm.prototype = Object.create(Modal.prototype);\n    ModalLogEntryForm.prototype.constructor = ModalLogEntryForm;\n\n    /**\n     * Set the context id to the given value.\n     *\n     * @method setContextId\n     * @param {Number} id The context id\n     */\n    ModalLogEntryForm.prototype.setContextId = function(id) {\n        this.contextId = id;\n    };\n\n    /**\n     * Retrieve the current context id, if any.\n     *\n     * @method getContextId\n     * @return {Number|null} The context id\n     */\n    ModalLogEntryForm.prototype.getContextId = function() {\n        return this.contextId;\n    };\n\n    /**\n     * Set the course id to the given value.\n     *\n     * @method setCourseId\n     * @param {int} id The course id\n     */\n    ModalLogEntryForm.prototype.setCourseId = function(id) {\n        this.courseId = id;\n    };\n\n    /**\n     * Retrieve the current course id, if any.\n     *\n     * @method getCourseId\n     * @return {int|null} The course id\n     */\n    ModalLogEntryForm.prototype.getCourseId = function() {\n        return this.courseId;\n    };\n\n    /**\n     * Check if the modal has an course id.\n     *\n     * @method hasCourseId\n     * @return {bool}\n     */\n    ModalLogEntryForm.prototype.hasCourseId = function() {\n        return this.courseId !== null;\n    };\n\n    /**\n     * Set the exercise id to the given value.\n     *\n     * @method setExerciseId\n     * @param {int} id The exercise id\n     */\n        ModalLogEntryForm.prototype.setExerciseId = function(id) {\n        this.exerciseId = id;\n    };\n\n    /**\n     * Retrieve the current exercise id, if any.\n     *\n     * @method getExerciseId\n     * @return {int|null} The exercise id\n     */\n    ModalLogEntryForm.prototype.getExerciseId = function() {\n        return this.exerciseId;\n    };\n\n    /**\n     * Check if the modal has an exercise id.\n     *\n     * @method hasExerciseId\n     * @return {bool}\n     */\n        ModalLogEntryForm.prototype.hasExerciseId = function() {\n        return this.exerciseId !== null;\n    };\n\n    /**\n     * Set the user id to the given value.\n     *\n     * @method setUserId\n     * @param {int} id The user id\n     */\n        ModalLogEntryForm.prototype.setUserId = function(id) {\n        this.userId = id;\n    };\n\n    /**\n     * Retrieve the current user id, if any.\n     *\n     * @method getUserId\n     * @return {int|null} The user id\n     */\n    ModalLogEntryForm.prototype.getUserId = function() {\n        return this.userId;\n    };\n\n    /**\n     * Check if the modal has an user id.\n     *\n     * @method hasUserId\n     * @return {bool}\n     */\n        ModalLogEntryForm.prototype.hasUserId = function() {\n        return this.userId !== null;\n    };\n\n    /**\n     * Set the logentry id to the given value.\n     *\n     * @method setLogentryId\n     * @param {int} id The logentry id\n     */\n    ModalLogEntryForm.prototype.setLogentryId = function(id) {\n        this.logentryId = id;\n    };\n\n    /**\n     * Retrieve the current logentry id, if any.\n     *\n     * @method getLogentryId\n     * @return {int|null} The logentry id\n     */\n    ModalLogEntryForm.prototype.getLogentryId = function() {\n        return this.logentryId;\n    };\n\n    /**\n     * Check if the modal has an logentry id.\n     *\n     * @method hasLogentryId\n     * @return {bool}\n     */\n    ModalLogEntryForm.prototype.hasLogentryId = function() {\n        return this.logentryId !== null && this.logentryId != 0;\n    };\n\n    /**\n     * Set the start time to the given value.\n     *\n     * @method setFlightDate\n     * @param {int} time The session date time\n     */\n    ModalLogEntryForm.prototype.setFlightDate = function(time) {\n        this.flightDate = time;\n    };\n\n    /**\n     * Retrieve the current start time, if any.\n     *\n     * @method getFlightDate\n     * @return {int|null} The start time\n     */\n    ModalLogEntryForm.prototype.getFlightDate = function() {\n        return this.flightDate;\n    };\n\n    /**\n     * Check if the modal has session date time.\n     *\n     * @method hasFlightDate\n     * @return {bool}\n     */\n    ModalLogEntryForm.prototype.hasFlightDate = function() {\n        return this.flightDate !== null;\n    };\n\n    /**\n     * Set the flight type of the logentry to the given value.\n     *\n     * @method setFlightType\n     * @param {string} flighttype The flight type (training/solo/check)\n     */\n     ModalLogEntryForm.prototype.setFlightType = function(flighttype) {\n        this.flightType = flighttype;\n    };\n\n    /**\n     * Retrieve flight type of the logentry.\n     *\n     * @method getFlightType\n     * @return {string} The flight type (training/solo/check)\n     */\n    ModalLogEntryForm.prototype.getFlightType = function() {\n        return this.flightType;\n    };\n\n    /**\n     * Check if the modal has an logentry id.\n     *\n     * @param  {bool} hasfindpirep  Whether find PIREP is enabled\n     * @method hasFindPIREP\n     * @return {bool}\n     */\n     ModalLogEntryForm.prototype.hasFindPIREP = function(hasfindpirep) {\n        if (typeof hasfindpirep !== 'undefined') {\n            this.hasfindpirep = hasfindpirep;\n        }\n        return this.hasfindpirep;\n    };\n\n    /**\n     * Get the form element from the modal.\n     *\n     * @method getForm\n     * @return {object}\n     */\n    ModalLogEntryForm.prototype.getForm = function() {\n        return this.getBody().find('form');\n    };\n\n    /**\n     * Disable the buttons in the footer.\n     *\n     * @method disableButtons\n     */\n    ModalLogEntryForm.prototype.disableButtons = function() {\n        this.saveButton.prop('disabled', true);\n    };\n\n    /**\n     * Enable the buttons in the footer.\n     *\n     * @method enableButtons\n     */\n    ModalLogEntryForm.prototype.enableButtons = function() {\n        this.saveButton.prop('disabled', false);\n    };\n\n    /**\n     * Reload the title for the modal to the appropriate value\n     * depending on whether we are creating a new log book entry\n     * or editing an existing one.\n     *\n     * @method reloadTitleContent\n     * @return {object} A promise resolved with the new title text\n     */\n    ModalLogEntryForm.prototype.reloadTitleContent = function() {\n        if (this.reloadingTitle) {\n            return this.titlePromise;\n        }\n\n        this.reloadingTitle = true;\n\n        // Get exercise name\n        this.titlePromise = Repository.getExerciseName(this.courseId, this.exerciseId)\n            .then(function(response) {\n                // Handle the response\n                return response.exercisename;\n            })\n        .fail(Notification.exception);\n\n        this.titlePromise.then(function(string) {\n            this.setTitle(string);\n            return string;\n        }.bind(this))\n        .always(function() {\n            this.reloadingTitle = false;\n            return;\n        }.bind(this))\n        .fail(Notification.exception);\n\n        return this.titlePromise;\n    };\n\n    /**\n     * Send a request to the server to get the logentry_form in a fragment\n     * and render the result in the body of the modal.\n     *\n     * If serialised form data is provided then it will be sent in the\n     * request to the server to have the form rendered with the data. This\n     * is used when the form had a server side error and we need the server\n     * to re-render it for us to display the error to the user.\n     *\n     * @method reloadBodyContent\n     * @param {string} formData The serialised form data\n     * @return {object} A promise resolved with the fragment html and js from\n     */\n    ModalLogEntryForm.prototype.reloadBodyContent = function(formData) {\n        if (this.reloadingBody) {\n            return this.bodyPromise;\n        }\n\n        this.reloadingBody = true;\n        this.disableButtons();\n\n        var args = {};\n\n        if (this.hasUserId()) {\n            args.userid = this.getUserId();\n        }\n\n        if (this.hasLogentryId()) {\n            args.logentryid = this.getLogentryId();\n        }\n\n        if (this.hasFlightDate()) {\n            args.flightdate = this.getFlightDate();\n        }\n\n        if (this.hasCourseId()) {\n            args.courseid = this.getCourseId();\n        }\n\n        if (this.hasExerciseId()) {\n            args.exerciseid = this.getExerciseId();\n        }\n\n        if (typeof formData !== 'undefined') {\n            args.formdata = formData;\n        }\n\n        // Get the content of the modal\n        this.bodyPromise = Fragment.loadFragment('local_booking', 'logentry_form', this.getContextId(), args);\n\n        // Set the body data using the promise\n        this.setBody(this.bodyPromise);\n\n        this.bodyPromise.then(function() {\n            // Add Find PIREP button\n            if (this.hasFindPIREP()) {\n                let pirepdiv = $('#id_p1pirep').parent();\n                if (!$('#id_error2_p1pirep').length) {\n                    pirepdiv.append('<div id=\"id_find_pirep\" ' +\n                        'tabindex=\"0\" style=\"\"><button type=\"button\" class=\"btn btn-primary\" ' +\n                        'data-form-type=\"action\"><i class=\"icon fa fa-search fa-fw\"></i></button></div>');\n                }\n            }\n\n            // Hide/show elements set training type\n            this.doDynamicDisplay();\n            this.enableButtons();\n            this.setInputMask();\n            this.registerChangeListeners();\n\n            return;\n        }.bind(this))\n        .fail(Notification.exception)\n        .always(function() {\n            this.reloadingBody = false;\n            return;\n        }.bind(this))\n        .fail(Notification.exception);\n\n        return this.bodyPromise;\n    };\n\n    /**\n     * Sets the input mask for all masked elements.\n     *\n     * @method setInputMask\n     */\n    ModalLogEntryForm.prototype.setInputMask = function() {\n        // Mask flight times < 5hrs and departure/arrival times to 24hr format\n        // Mask flight time elements based on training type\n        if ($(Selectors.bookingwrapper).data('trainingtype') == \"Dual\") {\n            Inputmask({\"regex\": \"^([0]?[0-4]):([0-5]?[0-9])$\"}).mask(document.getElementById(\"id_dualtime\"));\n        } else if ($(Selectors.bookingwrapper).data('trainingtype') == \"Multicrew\") {\n            Inputmask({\"regex\": \"^([0]?[0-4]):([0-5]?[0-9])$\"}).mask(document.getElementById(\"id_multipilottime\"));\n\n            // TODO: Instructor logentry edit:\n            // Inputmask({\"regex\": \"^([0]?[0-4]):([0-5]?[0-9])$\"}).mask(document.getElementById(\"id_copilottime\"));\n        }\n        // Check for the flight type before masking related elements\n        if ($(\"input[name='flighttypehidden']\").val() == 'check') {\n            Inputmask({\"regex\": \"^([0]?[0-4]):([0-5]?[0-9])$\"}).mask(document.getElementById(\"id_picustime\"));\n\n            // TODO: Instructor logentry edit:\n            // Inputmask({\"regex\": \"^([0]?[0-4]):([0-5]?[0-9])$\"}).mask(document.getElementById(\"id_checkpilottime\"));\n        } else if ($(\"input[name='flighttypehidden']\").val() == 'solo') {\n            Inputmask({\"regex\": \"^([0]?[0-4]):([0-5]?[0-9])$\"}).mask(document.getElementById(\"id_flighttime\"));\n        } else {\n            Inputmask({\"regex\": \"^([0]?[0-4]):([0-5]?[0-9])$\"}).mask(document.getElementById(\"id_groundtime\"));\n        }\n\n        // TODO: Instructor logentry edit:\n        // Inputmask({\"regex\": \"^([0]?[0-4]):([0-5]?[0-9])$\"}).mask(document.getElementById(\"id_pictime\"));\n        // Inputmask({\"regex\": \"^([0]?[0-4]):([0-5]?[0-9])$\"}).mask(document.getElementById(\"id_instructortime\"));\n\n        // Mask remaining elements\n        Inputmask({\"regex\": \"^([0]?[0-4]):([0-5]?[0-9])$\"}).mask(document.getElementById(\"id_flighttime\"));\n        Inputmask({\"regex\": \"^([01]?[0-9]|2[0-3]):[0-5][0-9]\"}).mask(document.getElementById(\"id_deptime\"));\n        Inputmask({\"regex\": \"^([01]?[0-9]|2[0-3]):[0-5][0-9]\"}).mask(document.getElementById(\"id_arrtime\"));\n        Inputmask({\"regex\": \"^([0]?[0-4]):([0-5]?[0-9])$\"}).mask(document.getElementById(\"id_nighttime\"));\n        Inputmask({\"regex\": \"^([0]?[0-4]):([0-5]?[0-9])$\"}).mask(document.getElementById(\"id_ifrtime\"));\n        Inputmask({\"regex\": \"[0-9]\"}).mask(document.getElementById(\"id_landingsp1day\"));\n        Inputmask({\"regex\": \"[0-9]\"}).mask(document.getElementById(\"id_landingsp1night\"));\n\n        // Check for new logentries noting landings of both instructor and student\n        if (this.getLogentryId() == 0) {\n            Inputmask({\"regex\": \"[0-9]\"}).mask(document.getElementById(\"id_landingsp2day\"));\n            Inputmask({\"regex\": \"[0-9]\"}).mask(document.getElementById(\"id_landingsp2night\"));\n        }\n    };\n\n    /**\n     * Sets the input mask for all masked elements.\n     *\n     * @method registerChangeListeners\n     */\n    ModalLogEntryForm.prototype.registerChangeListeners = function() {\n\n        // PIREP search trigger\n        if (this.hasFindPIREP()) {\n            var pirepbutton = $('#id_find_pirep');\n            pirepbutton.on('click', function(e) {\n                if (!isNaN($('#id_p1pirep').val())) {\n                    return this.getPIREPData(e);\n                }\n            }.bind(this));\n        }\n\n        // Update elements based on selected flighttype (Training/Solo)\n        var flighttype = $('input[name=\"flighttype\"]');\n        flighttype.on('change', function() {\n            // Assign the value selected in the radio buttons to the hidden flight type element\n            $(\"input[name='flighttypehidden']\").val($(\"input[name='flighttype']:checked\").val());\n            this.doDynamicDisplay();\n            this.applyFlightTimes();\n        }.bind(this));\n\n        // Update flight times when the test result status is changed\n        var passfail = $('input[name=\"passfail\"]');\n        passfail.on('change', function() {\n            this.doDynamicDisplay();\n            this.applyFlightTimes();\n        }.bind(this));\n\n        // Update flight times when the test result status is changed\n        var flightrule = $('input[name=\"flightrule\"]');\n        flightrule.on('change', function() {\n            this.doDynamicDisplay();\n            this.applyFlightTimes();\n        }.bind(this));\n\n        // The onchange property has to be set due to the flighttime element being masked\n        flighttime = document.getElementById(\"id_flighttime\");\n        flighttime.onchange = function() {\n            return this.applyFlightTimes(true);\n        }.bind(this);\n    };\n\n    /**\n     * Retrieve and populate log entry data from\n     * the server's PIREP lookup service.\n     *\n     * @method getPIREPData\n     * @param  {object} e The triggered event\n     * @return {object} pirep of the logentry\n     */\n     ModalLogEntryForm.prototype.getPIREPData = function(e) {\n        var loadingContainer = this.getFooter().find(SELECTORS.LOADING_ICON_CONTAINER);\n        rule = $(Selectors.bookingwrapper).data('trainingtype');\n        pirepdiv = $('#id_p1pirep').parent();\n        pirep = $('#id_p1pirep').val();\n        courseid = this.getCourseId();\n        exerciseid = this.getExerciseId();\n\n        if (pirep != '') {\n            loadingContainer.removeClass('hidden');\n            return Repository.findPirep(pirep, courseid, $('#id_p1id').val(), exerciseid)\n                .then(function(response) {\n                    // Clean up any past client side errors\n                    $('#id_p1pirep').removeClass('is-invalid');\n\n                    // Handle the response\n                    if (response.result) {\n                        // Get found message\n                        if (!$('#id_valid_p1pirep').length) {\n                            Str.get_string('pirepfound', 'local_booking').then(function(string) {\n                                pirepdiv.append('<div class=\"form-control-feedback valid-feedback\" id=\"id_valid_p1pirep\" ' +\n                                'tabindex=\"0\" style=\"\">' + string + '</div>');\n                                $('#id_p1pirep').addClass('is-valid');\n                                return string;\n                            })\n                            .fail(Notification.exception);\n                        }\n\n                        // Update elements with PIREP returned data depending on\n                        // solo flight status and flight rule (Dual/Multicrew)\n                        var d = new Date(response.logentry.flightdate * 1000),\n                            month = '' + (d.getMonth() + 1),\n                            day = '' + d.getDate(),\n                            year = d.getFullYear(),\n                            time = response.logentry.deptime,\n                            hour = time.substring(0, 2),\n                            minute = time.substring(time.indexOf(':') + 1, time.length);\n                        // Fill remaining data\n                        $('#id_flightdate_day').val(day);\n                        $('#id_flightdate_month').val(month);\n                        $('#id_flightdate_year').val(year);\n                        $('#id_flightdate_hour').val(hour);\n                        $('#id_flightdate_minute').val(minute);\n                        $('input[name=\"linkedpirep\"]').val(response.logentry.linkedpirep);\n                        $('#id_flighttime').val(response.logentry.flighttime);\n                        $('#id_depicao').val(response.logentry.depicao);\n                        $('#id_arricao').val(response.logentry.arricao);\n                        $('#id_deptime').val(response.logentry.deptime);\n                        $('#id_arrtime').val(response.logentry.arrtime);\n                        $('#id_callsign').val(response.logentry.callsign);\n                        $('#id_aircraft').val(response.logentry.aircraft);\n                        $('#id_aircraftreg').val(response.logentry.aircraftreg);\n                        $('#id_enginetype').val(response.logentry.enginetype);\n                        $('#id_route').val(response.logentry.route);\n                        $('#id_fstd').val(response.logentry.fstd);\n                        this.doDynamicDisplay();\n                        this.applyFlightTimes();\n                    } else {\n                        // Display inline error for the PIREP then clear it and give it focus\n                        $('#id_p1pirep').addClass('is-invalid');\n                        if (!$('#id_error2_p1pirep').length) {\n                            pirepdiv.append('<div class=\"form-control-feedback invalid-feedback\" id=\"id_error2_p1pirep\" ' +\n                                'tabindex=\"0\" style=\"\">' + response.warnings[0].message + '</div>');\n                            $('#id_p1pirep').val('');\n                            $('#id_p1pirep').focus();\n                        } else {\n                            $('#id_error2_p1pirep').show();\n                        }\n                        // Make sure the find button is always after the P1 PIREP element\n                        if (this.hasFindPIREP()) {\n                            $('#id_p1pirep').parent().each(function() {\n                                $('#id_find_pirep').insertAfter($('#id_p1pirep'), this);\n                            });\n                        }\n                    }\n\n                    return;\n                }.bind(this))\n                .always(function() {\n                    // Regardless of success or error we should always stop\n                    // the loading icon and re-enable the buttons.\n                    loadingContainer.addClass('hidden');\n                    e.preventDefault();\n                    e.stopPropagation();\n\n                    return;\n                })\n                .fail(Notification.exception);\n        } else {\n            return '';\n        }\n    };\n\n    /**\n     * Apply default values set flight operation\n     * Dual vs Multicrew taking solo flights in conisderation\n     *\n     * Populates a log book entry with a modal form data.\n     *\n     * @param {bool} force Force applying flight times\n     * @method applyFlightTimes\n     */\n     ModalLogEntryForm.prototype.applyFlightTimes = function(force) {\n\n        const rule = $(Selectors.bookingwrapper).data('trainingtype');\n        var flighttype = $(\"input[name='flighttypehidden']\").val(),\n            flighttime = $('#id_flighttime').val(),\n            passfail = $(\"input[name='passfail']:checked\").val(),\n            ifr = $(\"input[name='flightrule']:checked\").val() == 'ifr',\n            editmode = this.getLogentryId() != 0,\n            newentry = !editmode;\n\n        // Check the training rule type\n        if (newentry || force) {\n            if (flighttype == 'training' || (flighttype == 'check' && passfail == 'fail')) {\n                $('#id_dualtime').val(rule == 'Dual' ? flighttime : '');\n                $('#id_ifrtime').val(ifr ? flighttime : '');\n                $('#id_multipilottime').val(rule == 'Multicrew' ? flighttime : '');\n                $('#id_copilottime').val(rule == 'Multicrew' ? flighttime : '');\n                $('#id_checkpilottime').val(flighttype == 'check' ? flighttime : '');\n                $('#id_picustime').val('');\n            } else if (flighttype == 'solo') {\n                $('#id_ifrtime').val(ifr ? flighttime : '');\n                $('#id_dualtime').val('');\n                $('#id_multipilottime').val('');\n                $('#id_copilottime').val('');\n                $('#id_picustime').val('');\n            } else if (flighttype == 'check' || passfail == 'pass') {\n                $('#id_ifrtime').val(ifr ? flighttime : '');\n                $('#id_picustime').val(flighttime);\n                $('#id_checkpilottime').val(flighttime);\n                $('#id_multipilottime').val(rule == 'Multicrew' ? flighttime : '');\n                $('#id_dualtime').val('');\n                $('#id_copilottime').val('');\n            }\n        }\n     };\n\n    /**\n     * Apply default values set flight operation\n     * Dual vs Multicrew taking solo flights in conisderation\n     *\n     * Populates a log book entry with a modal form data.\n     *\n     * @method doDynamicDisplay\n     */\n     ModalLogEntryForm.prototype.doDynamicDisplay = function() {\n\n        const rule = $(Selectors.bookingwrapper).data('trainingtype');\n        var flighttype = $(\"input[name='flighttypehidden']\").val(),\n            passfail = $(\"input[name='passfail']:checked\").val(),\n            ifr = $(\"input[name='flightrule']:checked\").val() == 'ifr',\n            editmode = this.getLogentryId() != 0;\n\n        // Toggle the display of elements depending on flight type\n        var toggle = function(div, element, show, value, force = false) {\n            if (typeof div !== 'undefined' && typeof element !== 'undefined') {\n                // Check expanded status of Advanced elements\n                var ariaexpanded = this.getForm().find('[aria-expanded=\"true\"]').attr('aria-expanded');\n                if (ariaexpanded || force) {\n                    if (show) {\n                        $(div).slideDown('fast');\n                    } else {\n                        $(div).slideUp('fast');\n                    }\n                }\n\n                // Process the passed value\n                if (typeof value !== 'undefined') {\n                    $(element).val(value);\n                }\n            }\n        }.bind(this);\n\n        // Set dynamic element labels\n        var setLabel = function(element, editlabelkey, labelkey) {\n            if (editmode) {\n                Str.get_string(editlabelkey, 'local_booking').then(function(label) {\n                    $(element).text(label);\n                    return label;\n                }).fail(Notification.exception);\n            } else {\n                Str.get_string(labelkey, 'local_booking').then(function(label) {\n                    $(element).text(label);\n                    return label;\n                }).fail(Notification.exception);\n            }\n        };\n\n        // TODO: Instructor logentry edit:\n        // // Toggle PIC time in new and edit\n        // toggle('#fitem_id_pictime', '#id_pictime', $('#id_pictime').val());\n\n        // Check the training rule type\n        if (flighttype == 'training' || (flighttype == 'check' && passfail == 'fail')) {\n\n            // Set P1 id and label, and handle edit mode\n            if (flighttype == 'training' || editmode) {\n                p1label = rule == 'Dual' ? 'p1dual' : 'p1multicrew';\n            } else {\n                p1label = 'examiner';\n            }\n\n            setLabel(\"label[for='id_p1pirep']\", 'pirep', flighttype == 'training' ? 'instpirep' : 'examinerpirep');\n            setLabel(\"label[for='id_p1id']\", p1label, p1label);\n\n            // Toggle showing elements conditionally for training flight and failed check flights\n            toggle('#fitem_id_p2id', '#id_p2id', true);\n            toggle('#fitem_id_dualtime', '#id_dualtime', rule == 'Dual');\n            toggle('#fitem_id_groundtime', '#id_groundtime', true, $('#id_groundtime').val(), true);\n            toggle('#fitem_id_ifrtime', '#id_ifrtime', ifr);\n            toggle('#fitem_id_nighttime', '#id_nighttime', ifr);\n            toggle('#fitem_id_multipilottime', '#id_multipilottime', rule == 'Multicrew');\n            toggle('#fitem_id_copilottime', '#id_copilottime', rule == 'Multicrew');\n\n            // Toggle hiding elements\n            toggle('#fitem_id_checkpilottime', '#id_checkpilottime', false);\n            toggle('#fitem_id_picustime', '#id_picustime', false);\n\n            // TODO: Instructor logentry edit:\n            // // Toggle instructor time in new and edit\n            // toggle('#fitem_id_instructortime', '#id_instructortime', ((newentry && flighttype != 'check') || (editmode &&\n            //     $('#id_instructortime').val() != '')), editmode || flighttype == 'check' ?\n            //     $('#id_instructortime').val() ? $('#id_instructortime').val() : '' : flighttime);\n            // TODO: Instructor logentry edit:\n            // toggle('#fitem_id_checkpilottime', '#id_checkpilottime', false, '');\n\n        } else if (flighttype == 'solo') {\n            // Set P1 PIREP label for student solo flights, and handle edit mode\n            setLabel(\"label[for='id_p1pirep']\", 'logbooksolopirep', 'logbooksolopirep');\n            setLabel(\"label[for='id_p1id']\", 'p2dual', 'p2dual');\n            if (!editmode) {\n                $('#id_p1id').val($('#id_p2id').val());\n            }\n\n            // Toggle showing elements for solo flight\n            toggle('#fitem_id_ifrtime', '#id_ifrtime', ifr);\n            $('#id_landingsp1day').val('1');\n            $('#id_landingsp2day').val('0');\n\n            // Toggle hiding elements for solo flights\n            toggle('#fitem_id_p2id', '#id_p2id', false, $('#id_p2id').val(), true);\n            toggle('#fitem_id_groundtime', '#id_groundtime', false, '', true);\n            toggle('#fitem_id_dualtime', '#id_dualtime', false);\n            toggle('#fitem_id_multipilottime', '#id_multipilottime', false);\n            toggle('#fitem_id_copilottime', '#id_copilottime', false);\n            toggle('#fitem_id_picustime', '#id_picustime', false);\n            toggle('#fgroup_id_landingsp2', '#id_landingsp2', false);\n\n            // TODO: Instructor logentry edit:\n            // toggle('#fitem_id_instructortime', '#id_instructortime', false);\n            // TODO: Instructor logentry edit:\n            // toggle('#fitem_id_checkpilottime', '#id_checkpilottime', false);\n\n        } else if (flighttype == 'check' || passfail == 'pass') {\n            // Get id and label for P1 and PIREP\n            setLabel(\"label[for='id_p1pirep']\", 'pirep', 'examinerpirep');\n            setLabel(\"label[for='id_p1id']\", 'examiner', 'examiner');\n\n            // Toggle showing elements for passsed check flight\n            toggle('#fitem_id_p2id', '#id_p2id', true);\n            toggle('#fitem_id_ifrtime', '#id_ifrtime', ifr);\n            toggle('#fitem_id_multipilottime', '#id_multipilottime', rule == 'Multicrew');\n            toggle('#fitem_id_picustime', '#id_picustime', true);\n\n            // Toggle hiding elements for passed check flight\n            toggle('#fitem_id_dualtime', '#id_dualtime', false);\n            toggle('#fitem_id_copilottime', '#id_copilottime', false);\n\n            // TODO: Instructor logentry edit:\n            // toggle('#fitem_id_instructortime', '#id_instructortime', false);\n            toggle('#fitem_id_checkpilottime', '#id_checkpilottime', false);\n        }\n    };\n\n    /**\n     * Reload both the title and body content.\n     *\n     * @method reloadAllContent\n     * @return {object} promise\n     */\n    ModalLogEntryForm.prototype.reloadAllContent = function() {\n        return $.when(this.reloadTitleContent(), this.reloadBodyContent());\n    };\n\n    /**\n     * Kick off a reload the modal content before showing it. This\n     * is to allow us to re-use the same modal for creating and\n     * editing different log book entries within the booking view page.\n     *\n     * We do the reload when showing the modal rather than hiding it\n     * to save a request to the server if the user closes the modal\n     * and never re-opens it.\n     *\n     * @method show\n     */\n    ModalLogEntryForm.prototype.show = function() {\n        this.reloadAllContent();\n        Modal.prototype.show.call(this);\n    };\n\n    /**\n     * Clear the logentry id from the modal when it's closed so\n     * that it is loaded fresh next time it's displayed.\n     *\n     * The logentry id will be set by the calling code if it wants\n     * to edit a specific log entry.\n     *\n     * @method hide\n     */\n    ModalLogEntryForm.prototype.hide = function() {\n        Modal.prototype.hide.call(this);\n        this.setLogentryId(null);\n        this.setFlightDate(null);\n        this.setContextId(null);\n        this.setCourseId(null);\n        this.setExerciseId(null);\n    };\n\n    /**\n     * Get the serialised form data.\n     *\n     * @method getFormData\n     * @return {string} serialised form data\n     */\n    ModalLogEntryForm.prototype.getFormData = function() {\n        return this.getForm().serialize();\n    };\n\n    /**\n     * Send the form data to the server to create or update\n     * a log book entry.\n     *\n     * If there is a server side validation error then we re-request the\n     * rendered form (with the data) from the server in order to get the\n     * server side errors to display.\n     *\n     * On success the modal is hidden and the page is reloaded so that the\n     * new log book entry will display in the booking view user tooltip.\n     *\n     * @method save\n     * @return {object} A promise\n     */\n    ModalLogEntryForm.prototype.save = function() {\n        var invalid,\n            loadingContainer = this.saveButton.find(SELECTORS.LOADING_ICON_CONTAINER);\n\n        // Set ground time to 0 for none training flights as it is a required a value\n        if (!($(\"input[name='flighttypehidden']\").val() == 'training')) {\n            $('#id_groundtime').val(\"00:00\");\n        }\n\n        // Now the change events have run, see if there are any \"invalid\" form fields.\n        invalid = this.getForm().find('[aria-invalid=\"true\"]');\n\n        // If we found invalid fields, focus on the first one and do not submit via ajax.\n        if (invalid.length) {\n            invalid.first().focus();\n            return;\n        }\n\n        loadingContainer.removeClass('hidden');\n        this.disableButtons();\n\n        var formData = this.getFormData();\n        var formArgs = 'contextid=' + this.contextId + '&courseid=' + this.courseId\n            + '&exerciseid=' + this.exerciseId + '&userid=' + this.userId;\n\n        // Send the form data to the server for processing.\n        // eslint-disable-next-line consistent-return\n        return Repository.submitCreateUpdateLogentryForm(formArgs, formData)\n            .then(function(response) {\n                if (response.validationerror) {\n                    // If there was a server side validation error then\n                    // we need to re-request the rendered form from the server\n                    // in order to display the error for the user.\n                    this.reloadBodyContent(formData);\n                    return;\n                } else {\n                    // Check whether this was a new logbook entry or not.\n                    // check if the logentry is from the prgression view\n                    // logentry from the confirmation view\n                    // The hide function unsets the form data so grab this before the hide.\n                    var isExisting = this.hasLogentryId();\n\n                    // No problemo! Our work here is done.\n                    this.hide();\n\n                    // Trigger the appropriate logbook event so that the view can be updated.\n                    if (isExisting) {\n                        $('body').trigger(LogbookEvents.updated, [response.logentry]);\n                    } else {\n                        $('body').trigger(LogbookEvents.created, [response.logentry]);\n                    }\n                }\n\n                return;\n            }.bind(this))\n            .always(function() {\n                // Regardless of success or error we should always stop\n                // the loading icon and re-enable the buttons.\n                loadingContainer.addClass('hidden');\n                Notification.fetchNotifications();\n                this.enableButtons();\n\n                return;\n            }.bind(this))\n            .fail(Notification.exception);\n    };\n\n    /**\n     * Set up all of the event handling for the modal.\n     *\n     * @method registerEventListeners\n     */\n    ModalLogEntryForm.prototype.registerEventListeners = function() {\n        // Apply parent event listeners.\n        Modal.prototype.registerEventListeners.call(this);\n\n        // When the user clicks the save button we trigger the form submission. We need to\n        // trigger an actual submission because there is some JS code in the form that is\n        // listening for this event and doing some stuff (e.g. saving draft areas etc).\n        this.getModal().on(CustomEvents.events.activate, SELECTORS.SAVE_BUTTON, function(e, data) {\n            this.getForm().submit();\n            data.originalEvent.preventDefault();\n            e.stopPropagation();\n        }.bind(this));\n\n        // Catch the submit event before it is actually processed by the browser and\n        // prevent the submission. We'll take it from here.\n        this.getModal().on('submit', function(e) {\n            Event.notifyFormSubmitAjax(this.getForm()[0]);\n\n            this.save();\n\n            // Stop the form from actually submitting and prevent it's\n            // propagation because we have already handled the event.\n            e.preventDefault();\n            e.stopPropagation();\n        }.bind(this));\n\n        // Register a lister to Update elements for Advanced section when expanded, after its loaded\n        this.getModal().on('click', 'a[aria-expanded]', function() {\n            setTimeout(function() {\n                this.doDynamicDisplay();\n             }.bind(this), 100);\n        }.bind(this));\n    };\n\n    // Automatically register with the modal registry the first time this module is imported so that you can create modals\n    // of this type using the modal factory.\n    if (!registered) {\n        ModalRegistry.register(ModalLogEntryForm.TYPE, ModalLogEntryForm, 'local_booking/modal_logentry_form');\n        registered = true;\n    }\n\n    return ModalLogEntryForm;\n});\n"],"file":"modal_logentry_form.min.js"}