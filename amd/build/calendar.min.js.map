{"version":3,"file":"calendar.min.js","sources":["../src/calendar.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * This module is the highest level module for the calendar. It is\n * responsible for initialising all of the components required for\n * the calendar to run. It also coordinates the interaction between\n * components by listening for and responding to different events\n * triggered within the calendar UI.\n *\n *  Improvised from core_calendar.\n *\n * @module     local_booking/calendar\n * @author     Mustafa Hajjar (mustafahajjar@gmail.com)\n * @copyright  BAVirtual.co.uk Â© 2021\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine([\n            'jquery',\n            'local_booking/calendar_view_manager',\n            'local_booking/slot_actions',\n            'core_calendar/selectors',\n            'local_booking/events',\n        ],\n        function(\n            $,\n            CalendarViewManager,\n            SlotActions,\n            CalendarSelectors,\n        ) {\n\n    var SELECTORS = {\n        ROOT: \"[data-region='calendar']\",\n        DAY: \"[data-region='day']\",\n        SAVE_BUTTON: \"[data-region='save-button']\",\n        BOOK_BUTTON: \"[data-region='book-button']\",\n        COPY_BUTTON: \"[data-region='copy-button']\",\n        PASTE_BUTTON: \"[data-region='paste-button']\",\n        CLEAR_BUTTON: \"[data-region='clear-button']\",\n        LOADING_ICON: '.loading-icon',\n        CALENDAR_WEEK_WRAPPER: \".calendarwrapper\",\n        TODAY: '.today',\n    };\n\n    /**\n     * Register event listeners for the module.\n     *\n     * @method  registerEventListeners\n     * @param   {object} root The calendar root element\n     */\n    var registerEventListeners = function(root) {\n        // Get action type of the current week view or booking\n        const action = $(SELECTORS.CALENDAR_WEEK_WRAPPER).data('action');\n        var contextId = $(SELECTORS.CALENDAR_WEEK_WRAPPER).data('contextid');\n\n        // Listen the click on the Save button.\n        root.on('click', SELECTORS.SAVE_BUTTON, function() {\n            SlotActions.saveWeekSlots(root);\n        });\n\n        // Listen the click on the Save Booking button.\n        root.on('click', SELECTORS.BOOK_BUTTON, function() {\n            SlotActions.saveBookedSlot(root);\n        });\n\n        // Listen the click on the Copy button.\n        root.on('click', SELECTORS.COPY_BUTTON, function() {\n            SlotActions.copySlots(root);\n        });\n\n        // Listen the click on the Paste button.\n        root.on('click', SELECTORS.PASTE_BUTTON, function() {\n            SlotActions.pasteSlots(root);\n        });\n\n        // Listen the click on the Clear button.\n        root.on('click', SELECTORS.CLEAR_BUTTON, function() {\n            SlotActions.clearWeekSlots(root);\n        });\n\n        // Listen to click on the clickable slot areas/cells\n        if (contextId) {\n            // Listen the mouse down on the calendar grid posting.\n            root.on('mousedown', SELECTORS.DAY, function(e) {\n                SlotActions.setPosting(true);\n                SlotActions.postSlots(root, action, $(e.target));\n                e.preventDefault();\n            });\n\n            // Listen the mouse down on the calendar grid posting.\n            root.on('mouseover', SELECTORS.DAY, function(e) {\n                SlotActions.postSlots(root, action, $(e.target));\n                e.preventDefault();\n            });\n\n            // Listen the mouse down on the calendar grid posting.\n            root.on('mouseup', SELECTORS.DAY, function() {\n                SlotActions.setPosting(false);\n            });\n        }\n\n        // Remove loading\n        const loadingIconContainer = root.find(CalendarSelectors.containers.loadingIcon);\n        loadingIconContainer.addClass('hidden');\n\n    };\n\n    return {\n        init: function(root) {\n            root = $(root);\n            CalendarViewManager.startLoading(root);\n            CalendarViewManager.init(root);\n            registerEventListeners(root);\n            CalendarViewManager.stopLoading(root);\n        }\n    };\n});\n"],"names":["define","$","CalendarViewManager","SlotActions","CalendarSelectors","SELECTORS","init","root","startLoading","action","data","contextId","on","saveWeekSlots","saveBookedSlot","copySlots","pasteSlots","clearWeekSlots","e","setPosting","postSlots","target","preventDefault","find","containers","loadingIcon","addClass","registerEventListeners","stopLoading"],"mappings":";;;;;;;;;;;;;;AA8BAA,OAAM,yBAAC,CACK,SACA,sCACA,6BACA,0BACA,yBAEJ,SACIC,EACAC,oBACAC,YACAC,mBAGR,IAAIC,cAEK,sBAFLA,sBAGa,8BAHbA,sBAIa,8BAJbA,sBAKa,8BALbA,uBAMc,+BANdA,uBAOc,+BAPdA,gCASuB,mBAmE3B,MAAO,CACHC,KAAM,SAASC,MACXA,KAAON,EAAEM,MACTL,oBAAoBM,aAAaD,MACjCL,oBAAoBI,KAAKC,MA7DJ,SAASA,MAElC,MAAME,OAASR,EAAEI,iCAAiCK,KAAK,UACvD,IAAIC,UAAYV,EAAEI,iCAAiCK,KAAK,aAGxDH,KAAKK,GAAG,QAASP,uBAAuB,WACpCF,YAAYU,cAAcN,KAC9B,IAGAA,KAAKK,GAAG,QAASP,uBAAuB,WACpCF,YAAYW,eAAeP,KAC/B,IAGAA,KAAKK,GAAG,QAASP,uBAAuB,WACpCF,YAAYY,UAAUR,KAC1B,IAGAA,KAAKK,GAAG,QAASP,wBAAwB,WACrCF,YAAYa,WAAWT,KAC3B,IAGAA,KAAKK,GAAG,QAASP,wBAAwB,WACrCF,YAAYc,eAAeV,KAC/B,IAGII,YAEAJ,KAAKK,GAAG,YAAaP,eAAe,SAASa,GACzCf,YAAYgB,YAAW,GACvBhB,YAAYiB,UAAUb,KAAME,OAAQR,EAAEiB,EAAEG,SACxCH,EAAEI,gBACN,IAGAf,KAAKK,GAAG,YAAaP,eAAe,SAASa,GACzCf,YAAYiB,UAAUb,KAAME,OAAQR,EAAEiB,EAAEG,SACxCH,EAAEI,gBACN,IAGAf,KAAKK,GAAG,UAAWP,eAAe,WAC9BF,YAAYgB,YAAW,EAC3B,KAIyBZ,KAAKgB,KAAKnB,kBAAkBoB,WAAWC,aAC/CC,SAAS,UAS1BC,CAAuBpB,MACvBL,oBAAoB0B,YAAYrB,KACpC,EAER"}